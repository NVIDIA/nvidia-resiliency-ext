

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rank Assignment &mdash; nvidia-resiliency-ext 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2709fde1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Rank Filter" href="rank_filter.html" />
    <link rel="prev" title="State" href="state.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            nvidia-resiliency-ext
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../fault_tolerance/index.html">Fault Tolerance</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Inprocess Restart</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../usage_guide.html">Usage Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../api.html">API documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="wrap.html">Wrapper</a></li>
<li class="toctree-l3"><a class="reference internal" href="compose.html">Compose</a></li>
<li class="toctree-l3"><a class="reference internal" href="state.html">State</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Rank Assignment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Rank Assignment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rank-filtering">Rank Filtering</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rank_filter.html">Rank Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="initialize.html">Initialize</a></li>
<li class="toctree-l3"><a class="reference internal" href="abort.html">Abort</a></li>
<li class="toctree-l3"><a class="reference internal" href="finalize.html">Finalize</a></li>
<li class="toctree-l3"><a class="reference internal" href="health_check.html">Health Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="exception.html">Exceptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../checkpointing/async/index.html">Async Checkpointing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../checkpointing/local/index.html">Local Checkpointing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../straggler_det/index.html">Straggler Detection</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nvidia-resiliency-ext</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Inprocess Restart</a></li>
          <li class="breadcrumb-item"><a href="../api.html">API documentation</a></li>
      <li class="breadcrumb-item active">Rank Assignment</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/inprocess/api/rank_assignment.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rank-assignment">
<h1>Rank Assignment<a class="headerlink" href="#rank-assignment" title="Link to this heading"></a></h1>
<section id="id1">
<h2>Rank Assignment<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<section id="base-class">
<h3>Base class<a class="headerlink" href="#base-class" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">RankAssignment</span></span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#RankAssignment"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="Link to this definition"></a></dt>
<dd><p>Abstract base class for <code class="docutils literal notranslate"><span class="pre">rank_assignment</span></code> argument for
<code class="xref py py-class docutils literal notranslate"><span class="pre">inprocess.Wrapper</span></code>.</p>
<p><a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a> is responsible for reassigning distributed
ranks, computing the new world size and selecting which ranks are active in
the next iteration of the wrapped function.</p>
<p>Active ranks call the provided wrapped function. Inactive ranks are waiting
idle, and could serve as a pool of static, preallocated and preinitialized
reserve ranks. Reserve ranks would be activated in a subsequent restart
iteration if previously active ranks were terminated or became unhealthy.</p>
<p>Multiple instances of composable <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a> could be
composed with <code class="xref py py-class docutils literal notranslate"><span class="pre">inprocess.Compose</span></code> to achieve the desired
behavior.</p>
<dl class="py method">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment.__call__">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#RankAssignment.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment.__call__" title="Link to this definition"></a></dt>
<dd><p>Implementation of a <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ctx</strong> (<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx"><em>RankAssignmentCtx</em></a>) – <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignmentCtx</span></code></a></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Modified <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignmentCtx</span></code></a></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx"><em>RankAssignmentCtx</em></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">RankAssignmentCtx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">store</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">terminated_ranks</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#RankAssignmentCtx"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx" title="Link to this definition"></a></dt>
<dd><p>Represents inputs and outputs of <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<em>State</em>) – <code class="xref py py-class docutils literal notranslate"><span class="pre">Wrapper</span></code> state</p></li>
<li><p><strong>store</strong> (<em>StoreMixin</em>) – distributed store</p></li>
<li><p><strong>terminated_ranks</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.13)"><em>set</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>]</em>) – a set containing indices of terminated ranks</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.RankDiscarded">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">RankDiscarded</span></span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#RankDiscarded"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankDiscarded" title="Link to this definition"></a></dt>
<dd><p>Exception raised when a distributed rank is discarded by
<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a>.</p>
</dd></dl>

</section>
<section id="module-nvidia_resiliency_ext.inprocess.rank_assignment">
<span id="tree"></span><h3>Tree<a class="headerlink" href="#module-nvidia_resiliency_ext.inprocess.rank_assignment" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.Layer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">Layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">min_ranks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_ranks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_or_fn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flag</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#Layer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Layer" title="Link to this definition"></a></dt>
<dd><p>Represents a configuration for a layer of branches at a certain depth in
a topology tree constructed by <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Tree" title="nvidia_resiliency_ext.inprocess.rank_assignment.Tree"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tree</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>min_ranks</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>) – the minimum number of healthy ranks in a subtree</p></li>
<li><p><strong>max_ranks</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em> | </em><em>None</em>) – the maximum number of ranks to activate in a subtree, no
limit if <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a></p></li>
<li><p><strong>key_or_fn</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><em>Callable</em></a><em>[</em><em>[</em><em>State</em><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>]</em>) – a string key, or a <code class="docutils literal notranslate"><span class="pre">Callable</span></code> evaluated with
<code class="xref py py-class docutils literal notranslate"><span class="pre">inprocess.State</span></code> as input to produce a grouping string
key</p></li>
<li><p><strong>flag</strong> (<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag" title="nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag"><em>LayerFlag</em></a><em> | </em><em>None</em>) – an optional flag that modifies rank assignment policy in a given
branch</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">LayerFlag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#LayerFlag"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag" title="Link to this definition"></a></dt>
<dd><p>A flag to modify rank assignment or rank filtering policy in a given
<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Layer" title="nvidia_resiliency_ext.inprocess.rank_assignment.Layer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></a> of a <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Tree" title="nvidia_resiliency_ext.inprocess.rank_assignment.Tree"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tree</span></code></a> rank assignment.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE">
<span class="sig-name descname"><span class="pre">RESERVE</span></span><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE" title="Link to this definition"></a></dt>
<dd><p>indicates that branches at this layer of the topology tree may
be traversed while searching for a replacement inactive rank</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.BACKFILL">
<span class="sig-name descname"><span class="pre">BACKFILL</span></span><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.BACKFILL" title="Link to this definition"></a></dt>
<dd><p>indicates that branches at this layer of the topology tree
may be traversed while searching for a replacement active rank</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.Tree">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">Tree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">world_size_filter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#Tree"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Tree" title="Link to this definition"></a></dt>
<dd><p>Implements an integrated rank assignment and activation algorithm that
builds a multi-layer topology tree for distributed ranks. Each layer in
this tree specifies constraints and policies for assigning and activating
ranks. Grouping keys in each layer can align with hardware properties
(e.g., to confine ranks within a compute node) or application-driven
requirements (e.g., ensuring a particular divisibility).</p>
<p><a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Tree" title="nvidia_resiliency_ext.inprocess.rank_assignment.Tree"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tree</span></code></a> constructs a rooted topology tree whose depth equals the
number of layers. Each layer corresponds to a <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Layer" title="nvidia_resiliency_ext.inprocess.rank_assignment.Layer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></a>,
determining the rank assignment policy within its subtree. The distributed
ranks are represented as leaves.</p>
<p><strong>Algorithm</strong></p>
<p><strong>Initialization</strong></p>
<p>The algorithm traverses all ranks in depth-first order. For each visited
rank, if all ancestor layers permit more active ranks (i.e., if the
already-active ranks do not exceed any ancestor layer’s
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Layer.max_ranks</span></code>), that rank is activated.</p>
<p><strong>Rank reassignment</strong></p>
<p>When some ranks terminate or become unhealthy, the algorithm proceeds in
several steps:</p>
<ol class="arabic simple">
<li><p><strong>Propagate termination</strong></p></li>
</ol>
<p>Using a reverse depth-first search (children before parents), if the number
of healthy ranks in a branch falls below <code class="xref py py-attr docutils literal notranslate"><span class="pre">Layer.min_ranks</span></code>, that
entire branch (and its subtree) is terminated.</p>
<ol class="arabic simple" start="2">
<li><p><strong>Replace ranks from a reserve domain</strong></p></li>
</ol>
<p>The algorithm attempts to replace terminated or unhealthy active ranks with
inactive ranks from the nearest ancestor subtree that has the
<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE" title="nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">LayerFlag.RESERVE</span></code></a> flag. This search for an inactive rank
continues recursively upward until a branch without the
<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE" title="nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">LayerFlag.RESERVE</span></code></a> flag is reached.</p>
<ol class="arabic simple" start="3">
<li><p><strong>Backfill ranks</strong></p></li>
</ol>
<p>Within any ancestor subtree flagged as <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.BACKFILL" title="nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.BACKFILL"><code class="xref py py-attr docutils literal notranslate"><span class="pre">LayerFlag.BACKFILL</span></code></a>, an
active rank with the largest rank index swaps places with a terminated
rank, effectively filling local gaps (similar to <code class="xref py py-class docutils literal notranslate"><span class="pre">FillGaps</span></code>).</p>
<ol class="arabic simple" start="4">
<li><p><strong>Shift ranks</strong></p></li>
</ol>
<p>After local backfills, remaining gaps from unhandled terminations are
closed by shifting healthy ranks left to fill any vacated indices.
This global step reassigns all rank indices past the first unhealthy
rank (similar to <code class="xref py py-class docutils literal notranslate"><span class="pre">ShiftRanks</span></code>).</p>
<ol class="arabic simple" start="5">
<li><p><strong>Optional filter</strong></p></li>
</ol>
<p>If a <code class="docutils literal notranslate"><span class="pre">world_size_filter</span></code> callable is provided, it can reduce the
active ranks to a smaller <code class="docutils literal notranslate"><span class="pre">world_size</span></code> necessary for the workload.
<code class="docutils literal notranslate"><span class="pre">world_size_filter</span></code> is invoked with the current number of active ranks as
an argument, and returns the adjusted number of requested active ranks, no
greater than the input. Healthy ranks with indices greater than the value
returned value are deactivated and become part of the reserve pool.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Tree" title="nvidia_resiliency_ext.inprocess.rank_assignment.Tree"><code class="xref py py-class docutils literal notranslate"><span class="pre">Tree</span></code></a> cannot be composed with any other instance of
<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a> or <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankFilter</span></code></a>.</p>
</div>
<p><strong>Example</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">inprocess</span><span class="o">.</span><span class="n">rank_assignment</span><span class="o">.</span><span class="n">Tree</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">inprocess</span><span class="o">.</span><span class="n">rank_assignment</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span>
            <span class="n">min_ranks</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
            <span class="n">max_ranks</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
            <span class="n">key_or_fn</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span>
            <span class="n">flag</span><span class="o">=</span><span class="n">inprocess</span><span class="o">.</span><span class="n">rank_assignment</span><span class="o">.</span><span class="n">LayerFlag</span><span class="o">.</span><span class="n">RESERVE</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">inprocess</span><span class="o">.</span><span class="n">rank_assignment</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span>
            <span class="n">min_ranks</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">max_ranks</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">key_or_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span>
            <span class="n">flag</span><span class="o">=</span><span class="n">inprocess</span><span class="o">.</span><span class="n">rank_assignment</span><span class="o">.</span><span class="n">LayerFlag</span><span class="o">.</span><span class="n">RESERVE</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In this two-level topology tree:</p>
<ul class="simple">
<li><p>The first layer (hostname-based) allows up to 8 active ranks per host
(<code class="xref py py-attr docutils literal notranslate"><span class="pre">Layer.max_ranks=8</span></code>). If the number of healthy ranks in any
host drops below 8 (<code class="xref py py-attr docutils literal notranslate"><span class="pre">Layer.min_ranks=8</span></code>), that entire host’s
subtree is terminated. The algorithm can look for inactive reserve ranks
within the same hostname because of the <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE" title="nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">LayerFlag.RESERVE</span></code></a> flag.</p></li>
<li><p>All hosts are grouped under the <code class="docutils literal notranslate"><span class="pre">'root'</span></code> layer, which permits up to 256
active ranks (<code class="xref py py-attr docutils literal notranslate"><span class="pre">Layer.max_ranks=256</span></code>). If the global healthy
rank count drops below 128 (<code class="xref py py-attr docutils literal notranslate"><span class="pre">Layer.min_ranks=128</span></code>), all ranks
are terminated. The <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE" title="nvidia_resiliency_ext.inprocess.rank_assignment.LayerFlag.RESERVE"><code class="xref py py-attr docutils literal notranslate"><span class="pre">LayerFlag.RESERVE</span></code></a> flag at the <code class="docutils literal notranslate"><span class="pre">'root'</span></code>
level lets the algorithm traverse upward from one host to another host
through the <code class="docutils literal notranslate"><span class="pre">'root'</span></code> to search for reserve ranks.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><em>list</em></a><em>[</em><a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Layer" title="nvidia_resiliency_ext.inprocess.rank_assignment.Layer"><em>Layer</em></a><em>]</em>) – a list of <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.Layer" title="nvidia_resiliency_ext.inprocess.rank_assignment.Layer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></a> instances, each layer specifies
properties corresponding to one grouping level in a topology tree</p></li>
<li><p><strong>world_size_filter</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><em>Callable</em></a><em>[</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>] </em><em>| </em><em>None</em>) – an optional <code class="docutils literal notranslate"><span class="pre">Callable</span></code> that takes the final
application-visible world size, and returns the new world size, no
greater than the input</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="composable-rank-assignments">
<h3>Composable Rank Assignments<a class="headerlink" href="#composable-rank-assignments" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">FillGaps</span></span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#FillGaps"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>A class for reassigning distributed ranks, filling in gaps caused by
terminated or unhealthy ranks.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">FillGaps</span></code> class is a specialized rank assignment strategy
that reorders ranks to fill gaps created by terminated or unhealthy ranks.
It preserves the previous rank assignment for the first <code class="docutils literal notranslate"><span class="pre">world_size</span> <span class="pre">-</span>
<span class="pre">len(terminated_ranks)</span></code> healthy ranks; the remaining healthy ranks are
reassigned to fill in gaps left by unhealthy ranks.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">|&lt;---</span> <span class="n">preserved</span> <span class="o">---&gt;|&lt;-</span> <span class="n">moved</span> <span class="o">-&gt;|</span>     <span class="o">|&lt;--</span><span class="n">new</span> <span class="n">world</span> <span class="n">size</span><span class="o">-&gt;|</span>

<span class="o">+---+---+---+---+---+---+---+---+</span>     <span class="o">+---+---+---+---+---+</span>
<span class="o">|</span> <span class="mi">0</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">3</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="mi">6</span> <span class="o">|</span> <span class="mi">7</span> <span class="o">|</span> <span class="o">--&gt;</span> <span class="o">|</span> <span class="mi">0</span> <span class="o">|</span> <span class="mi">6</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">3</span> <span class="o">|</span> <span class="mi">7</span> <span class="o">|</span>
<span class="o">+---+---+---+---+---+---+---+---+</span>     <span class="o">+---+---+---+---+---+</span>
      <span class="o">^</span>           <span class="o">^</span>        <span class="o">|</span>  <span class="o">|</span>
      <span class="o">|</span>           <span class="o">|</span>        <span class="o">|</span>  <span class="o">|</span>
      <span class="o">---------------------</span>   <span class="o">|</span>
                  <span class="o">|</span>           <span class="o">|</span>
                  <span class="o">-------------</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">FilterCountGroupedByKey</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key_or_fn</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">condition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">datetime.timedelta(seconds=60)</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#FilterCountGroupedByKey"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>A class for filtering distributed ranks by grouping by a key.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterCountGroupedByKey</span></code> organizes ranks into groups based on a
specified string key. For each group, it increments a group counter by 1
for every healthy rank. A given boolean <code class="docutils literal notranslate"><span class="pre">condition</span></code> is then evaluated for
each rank, with the corresponding group counter passed as input.</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">condition(group_counter)</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the rank is
preserved.</p></li>
<li><p>If it evaluates to <code class="docutils literal notranslate"><span class="pre">False</span></code>, the rank is considered unhealthy and marked
for termination.</p></li>
</ul>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">FilterCountGroupedByKey</span></code> needs to be followed by another
<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a> that performs the actual rank termination by
raising <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankDiscarded" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankDiscarded"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RankDiscarded</span></code></a> exception.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">condition</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">count</span><span class="p">:</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">2</span>

<span class="o">+---+---+---+---+---+---+---+---+</span>     <span class="o">+---+---+---+---+---+---+---+---+</span>
<span class="o">|</span> <span class="mi">0</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">3</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="mi">6</span> <span class="o">|</span> <span class="mi">7</span> <span class="o">|</span> <span class="o">--&gt;</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">3</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="mi">6</span> <span class="o">|</span> <span class="mi">7</span> <span class="o">|</span>
<span class="o">+---+---+---+---+---+---+---+---+</span>     <span class="o">+---+---+---+---+---+---+---+---+</span>
<span class="o">|</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span> <span class="o">|</span> <span class="n">key</span><span class="o">=</span><span class="mi">1</span> <span class="o">|</span> <span class="n">key</span><span class="o">=</span><span class="mi">2</span> <span class="o">|</span> <span class="n">key</span><span class="o">=</span><span class="mi">3</span> <span class="o">|</span>     <span class="o">|</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span> <span class="o">|</span> <span class="n">key</span><span class="o">=</span><span class="mi">1</span> <span class="o">|</span> <span class="n">key</span><span class="o">=</span><span class="mi">2</span> <span class="o">|</span> <span class="n">key</span><span class="o">=</span><span class="mi">3</span> <span class="o">|</span>
<span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>     <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>
<span class="o">|</span><span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="o">|</span><span class="n">count</span><span class="o">=</span><span class="mi">2</span><span class="o">|</span><span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="o">|</span><span class="n">count</span><span class="o">=</span><span class="mi">2</span><span class="o">|</span>     <span class="o">|</span> <span class="kc">False</span> <span class="o">|</span> <span class="kc">True</span>  <span class="o">|</span> <span class="kc">False</span> <span class="o">|</span> <span class="kc">True</span>  <span class="o">|</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># hostname is the group key, and condition checks if exactly 8 ranks</span>
<span class="c1"># corresponding to a given hostname are in a healthy state, if the</span>
<span class="c1"># count is different than 8, all ranks from corresponding hostname are</span>
<span class="c1"># considered unhealthy, and terminated; remaining healthy ranks are</span>
<span class="c1"># shifted to the left to fill all gaps created by unhealthy ranks.</span>

<span class="n">rank_assignment</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">inprocess</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
        <span class="n">inprocess</span><span class="o">.</span><span class="n">rank_assignment</span><span class="o">.</span><span class="n">ShiftRanks</span><span class="p">(),</span>
        <span class="n">inprocess</span><span class="o">.</span><span class="n">rank_assignment</span><span class="o">.</span><span class="n">FilterCountGroupedByKey</span><span class="p">(</span>
            <span class="n">key_or_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span>
            <span class="n">condition</span><span class="o">=</span><span class="k">lambda</span> <span class="n">count</span><span class="p">:</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">8</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">),</span>
<span class="p">),</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key_or_fn</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em> | </em><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><em>Callable</em></a><em>[</em><em>[</em><em>State</em><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a><em>]</em>) – a string key, or a <code class="docutils literal notranslate"><span class="pre">Callable</span></code> evaluated with
<code class="xref py py-class docutils literal notranslate"><span class="pre">inprocess.state.State</span></code> as the input to produce a string
key</p></li>
<li><p><strong>condition</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.13)"><em>Callable</em></a><em>[</em><em>[</em><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em>]</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a><em>]</em>) – condition to be evaluated with group counter as the input,
if <code class="docutils literal notranslate"><span class="pre">False</span></code> the rank is terminated</p></li>
<li><p><strong>timeout</strong> (<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.13)"><em>timedelta</em></a>) – timeout for distributed barrier</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">ShiftRanks</span></span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#ShiftRanks"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>A class for reassigning distributed ranks, filling in gaps caused by
terminated or unhealthy ranks.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">ShiftRanks</span></code> class is a specialized rank assignment strategy
that shifts all healthy ranks to the left to fill gaps created by
terminated or unhealthy ranks. <code class="xref py py-class docutils literal notranslate"><span class="pre">ShiftRanks</span></code> preserves the
relative order of all healthy ranks, but all ranks past the first unhealthy
rank are reassigned (shifted).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="o">&lt;-</span>   <span class="o">-&gt;|&lt;-------</span> <span class="n">moved</span> <span class="o">-------&gt;|</span>     <span class="o">|&lt;--</span><span class="n">new</span> <span class="n">world</span> <span class="n">size</span><span class="o">-&gt;|</span>

          <span class="o">----</span>
          <span class="n">v</span>   <span class="o">|</span>
<span class="o">+---+---+---+---+---+---+---+---+</span>     <span class="o">+---+---+---+---+---+</span>
<span class="o">|</span> <span class="mi">0</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">3</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="n">X</span> <span class="o">|</span> <span class="mi">6</span> <span class="o">|</span> <span class="mi">7</span> <span class="o">|</span> <span class="o">--&gt;</span> <span class="o">|</span> <span class="mi">0</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">3</span> <span class="o">|</span> <span class="mi">6</span> <span class="o">|</span> <span class="mi">7</span> <span class="o">|</span>
<span class="o">+---+---+---+---+---+---+---+---+</span>     <span class="o">+---+---+---+---+---+</span>
      <span class="o">^</span>   <span class="o">|</span>   <span class="o">^</span>   <span class="o">^</span>       <span class="o">|</span>   <span class="o">|</span>
      <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>   <span class="o">|</span>       <span class="o">|</span>   <span class="o">|</span>
      <span class="o">----</span>     <span class="o">------------</span>   <span class="o">|</span>
                  <span class="o">|</span>           <span class="o">|</span>
                  <span class="o">------------</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
<section id="rank-filtering">
<h2>Rank Filtering<a class="headerlink" href="#rank-filtering" title="Link to this heading"></a></h2>
<section id="id2">
<h3>Base class<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">RankFilter</span></span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#RankFilter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter" title="Link to this definition"></a></dt>
<dd><p><a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankFilter</span></code></a> is a subclass of <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a> which
selects which ranks are active in the current restart iteration of
<code class="xref py py-class docutils literal notranslate"><span class="pre">inprocess.Wrapper</span></code>.</p>
<p>Active ranks call the wrapped function. Inactive ranks are waiting idle,
and could serve as a pool of static, preallocated and preinitialized
reserve ranks. Reserve ranks would be activated in a subsequent restart
iteration if one of the active ranks is terminated or becomes unhealthy.</p>
<p>Multiple <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankFilter</span></code></a> or <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a> instances can
be composed using <code class="xref py py-class docutils literal notranslate"><span class="pre">inprocess.Compose</span></code> to achieve the desired
behavior. Typically, all <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankFilter</span></code></a> instances should follow any
<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a> steps that recalculate rank indices or adjust
the world size.</p>
<dl class="py method">
<dt class="sig sig-object py" id="nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter.__call__">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ctx</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#RankFilter.__call__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter.__call__" title="Link to this definition"></a></dt>
<dd><p>Implementation of a <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankFilter"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankFilter</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ctx</strong> (<a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx"><em>RankAssignmentCtx</em></a>) – <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignmentCtx</span></code></a></p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Modified <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignmentCtx</span></code></a></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignmentCtx"><em>RankAssignmentCtx</em></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="rank-filters">
<h3>Rank Filters<a class="headerlink" href="#rank-filters" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">ActivateAllRanks</span></span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#ActivateAllRanks"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p>Activates all distributed ranks.</p>
<p>All healthy distributed ranks will call the provided wrapped function in
the next iteration of <code class="xref py py-class docutils literal notranslate"><span class="pre">inprocess.Wrapper</span></code>.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">ActivateAllRanks</span></code> unconditionally activates all ranks, and
cannot be combined with any other <a class="reference internal" href="#nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment" title="nvidia_resiliency_ext.inprocess.rank_assignment.RankAssignment"><code class="xref py py-class docutils literal notranslate"><span class="pre">RankAssignment</span></code></a> performing
rank activation.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">ActiveWorldSizeDivisibleBy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">divisor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#ActiveWorldSizeDivisibleBy"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p><code class="xref py py-class docutils literal notranslate"><span class="pre">ActiveWorldSizeDivisibleBy</span></code> ensures that the active world size
is divisible by a given number. Ranks within the adjusted world size are
marked as active and are calling the wrapped function, while ranks outside
this range are marked as inactive.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>divisor</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a>) – the divisor to adjust the active world size by</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nvidia_resiliency_ext.inprocess.rank_assignment.</span></span><span class="sig-name descname"><span class="pre">MaxActiveWorldSize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_active_world_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/nvidia_resiliency_ext/inprocess/rank_assignment.html#MaxActiveWorldSize"><span class="viewcode-link"><span class="pre">[source]</span></span></a></dt>
<dd><p><code class="xref py py-class docutils literal notranslate"><span class="pre">MaxActiveWorldSize</span></code> ensures that the active world size is no
greater than the specified <code class="docutils literal notranslate"><span class="pre">max_active_world_size</span></code>. Ranks with indices
less than the active world size are active and calling the wrapped
function, while ranks outside this range are inactive.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>max_active_world_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><em>int</em></a><em> | </em><em>None</em>) – maximum active world size, no limit if
<a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a></p>
</dd>
</dl>
</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="state.html" class="btn btn-neutral float-left" title="State" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rank_filter.html" class="btn btn-neutral float-right" title="Rank Filter" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, NVIDIA Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>